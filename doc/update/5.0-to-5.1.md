# From 5.0 to 5.1
*Make sure you view this [upgrade guide from the `master` branch](../../../master/doc/update/5.0-to-5.1.md) for the most up to date instructions.*

## Warning

<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
GitLab 5.1 is affected by critical security vulnerability CVE-2013-4490.
=======
### 1. Stop server
>>>>>>> gitlabhq/5-1-stable

## Release notes

<<<<<<< HEAD
- `unicorn` replaced with `puma`
- merge request cached diff will be truncated

## 1. Stop server

    sudo service gitlab stop

## 2. Get latest code

=======
### 2. Get latest code

>>>>>>> gitlabhq/5-1-stable
=======
### 1. Stop server

    sudo service gitlab stop

### 2. Get latest code

>>>>>>> origin/5-1-stable
=======
### 1. Stop server

    sudo service gitlab stop

### 2. Get latest code

>>>>>>> gitlabhq/5-1-stable
=======
### 1. Stop server

    sudo service gitlab stop

### 2. Get latest code

>>>>>>> origin/5-1-stable
```bash
cd /home/git/gitlab
sudo -u git -H git fetch
sudo -u git -H git checkout 5-1-stable
```

<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
## 3. Update gitlab-shell
=======
### 3. Update gitlab-shell
>>>>>>> gitlabhq/5-1-stable
=======
### 3. Update gitlab-shell
>>>>>>> origin/5-1-stable
=======
### 3. Update gitlab-shell
>>>>>>> gitlabhq/5-1-stable
=======
### 3. Update gitlab-shell
>>>>>>> origin/5-1-stable

```bash
cd /home/git/gitlab-shell
sudo -u git -H git fetch
sudo -u git -H git checkout v1.3.0
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
# replace your old config with the new one
sudo -u git -H mv config.yml config.yml.old
sudo -u git -H cp config.yml.example config.yml
# edit options to match old config
sudo -u git -H vi config.yml
```

## 4. Install libs, migrations etc

```bash
cd /home/git/gitlab
sudo rm tmp/sockets/gitlab.socket
sudo -u git -H cp config/puma.rb.example config/puma.rb
=======
```

### 4. Install libs, migrations etc
>>>>>>> gitlabhq/5-1-stable
=======
```

### 4. Install libs, migrations etc
>>>>>>> origin/5-1-stable

=======
```

### 4. Install libs, migrations etc

>>>>>>> gitlabhq/5-1-stable
=======
```

### 4. Install libs, migrations etc

>>>>>>> origin/5-1-stable
```bash
cd /home/git/gitlab
sudo rm tmp/sockets/gitlab.socket
sudo -u git -H cp config/puma.rb.example config/puma.rb
```
If you are using MySQL:
```
sudo -u git -H bundle install --without development test postgres --deployment
```
If you are using PostgreSQL:
```
sudo -u git -H bundle install --without development test mysql --deployment
```

```
sudo -u git -H bundle exec rake db:migrate RAILS_ENV=production
sudo -u git -H bundle exec rake migrate_merge_requests RAILS_ENV=production
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
sudo -u git -H bundle exec rake assets:precompile RAILS_ENV=production
```

## 5. Update init.d script with a new one
=======
```

### 5. Update init.d script with a new one
>>>>>>> gitlabhq/5-1-stable
=======
```

### 5. Update init.d script with a new one
>>>>>>> origin/5-1-stable
=======
```

### 5. Update init.d script with a new one
>>>>>>> gitlabhq/5-1-stable
=======
```

### 5. Update init.d script with a new one
>>>>>>> origin/5-1-stable

```bash
# init.d
sudo rm /etc/init.d/gitlab
sudo curl -L --output /etc/init.d/gitlab https://raw.github.com/gitlabhq/gitlab-recipes/5-1-stable/init.d/gitlab
sudo chmod +x /etc/init.d/gitlab
```

<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
## 6. MySQL grant privileges
=======
### 6. MySQL grant privileges
>>>>>>> gitlabhq/5-1-stable
=======
### 6. MySQL grant privileges
>>>>>>> origin/5-1-stable
=======
### 6. MySQL grant privileges
>>>>>>> gitlabhq/5-1-stable
=======
### 6. MySQL grant privileges
>>>>>>> origin/5-1-stable

Only if you are using MySQL:

```bash
mysql -u root -p
mysql> GRANT LOCK TABLES ON `gitlabhq_production`.* TO 'gitlab'@'localhost';
mysql> \q
```

<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
## 7. Start application
=======
### 7. Start application
>>>>>>> gitlabhq/5-1-stable
=======
### 7. Start application
>>>>>>> origin/5-1-stable
=======
### 7. Start application
>>>>>>> gitlabhq/5-1-stable
=======
### 7. Start application
>>>>>>> origin/5-1-stable

    sudo service gitlab start

## 8. Check installation


```bash
# In 5-10 seconds lets check gitlab-shell
sudo -u git -H /home/git/gitlab-shell/bin/check

# Example of success output
# Check GitLab API access: OK
# Check directories and files:
#         /home/git/repositories: OK
#         /home/git/.ssh/authorized_keys: OK


# Now check gitlab instance
sudo -u git -H bundle exec rake gitlab:check RAILS_ENV=production

```
