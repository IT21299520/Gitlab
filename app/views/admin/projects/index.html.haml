- page_title "Projects"
= render 'shared/show_aside'

.row
  %aside.col-md-3
    .admin-filter
      = bootstrap_form_tag url: admin_namespaces_projects_path, method: :get do |f|
        = f.text_field :name, value: params[:name]
        = f.form_group label: { text: 'Namespace' } do
          = namespace_select_tag :namespace_id, selected: params[:namespace_id], class: 'input-large'

        = f.form_group label: { text: 'Activity' } do
          = f.check_box :with_push, name: :with_push, label: 'Projects with push events', checked: params[:with_push]
          = f.check_box :abandoned, name: :abandoned, label: 'No activity over 6 month', checked: params[:abandoned]

        = f.form_group label: { text: 'Visibility level' } do
          - Project.visibility_levels.each do |label, level|
            -# TODO: Put back `visibility_level_icon(level)`
            = f.check_box :visibility_levels, name: 'visibility_levels[]', label: label, value: level, checked: params[:visibility_levels].present? && params[:visibility_levels].include?(level.to_s)

        %hr
        = hidden_field_tag :sort, params[:sort]
        = button_tag "Search", class: "btn submit btn-primary"
        = link_to "Reset", admin_namespaces_projects_path, class: "btn btn-cancel"

  %section.col-md-9
    .panel.panel-default
      .panel-heading
        Projects (#{@projects.total_count})
        .panel-head-actions
          .dropdown.inline
            %button.dropdown-toggle.btn.btn-sm{type: 'button', 'data-toggle' => 'dropdown'}
              %span.light sort:
              - if @sort.present?
                = sort_options_hash[@sort]
              - else
                = sort_title_recently_created
              %b.caret
            %ul.dropdown-menu
              %li
                = link_to admin_namespaces_projects_path(sort: sort_value_recently_created) do
                  = sort_title_recently_created
                = link_to admin_namespaces_projects_path(sort: sort_value_oldest_created) do
                  = sort_title_oldest_created
                = link_to admin_namespaces_projects_path(sort: sort_value_recently_updated) do
                  = sort_title_recently_updated
                = link_to admin_namespaces_projects_path(sort: sort_value_oldest_updated) do
                  = sort_title_oldest_updated
                = link_to admin_namespaces_projects_path(sort: sort_value_largest_repo) do
                  = sort_title_largest_repo
          = link_to 'New Project', new_project_path, class: "btn btn-sm btn-success"
      %ul.well-list
        - @projects.each do |project|
          %li
            .list-item-name
              %span{ class: visibility_level_color(project.visibility_level) }
                = visibility_level_icon(project.visibility_level)
              = link_to project.name_with_namespace, [:admin, project.namespace.becomes(Namespace), project]
            .pull-right
              %span.label.label-gray
                = repository_size(project)
              = link_to 'Edit', edit_namespace_project_path(project.namespace, project), id: "edit_#{dom_id(project)}", class: "btn btn-sm"
              = link_to 'Destroy', [project.namespace.becomes(Namespace), project], data: { confirm: remove_project_message(project) }, method: :delete, class: "btn btn-sm btn-remove"
        - if @projects.blank?
          .nothing-here-block 0 projects matches
    = paginate @projects, theme: "gitlab"
