= render "repositories/branches_head"

.alert
  %p=t '.desc'
  %p=t '.features.desc'
  %ul
    %li=t '.features.keep_secure'
    %li=t '.features.forced_review'
  %p
    = t 'errors.access_denied.further_info'
    = link_to t('errors.access_denied.further_info_href'), help_permissions_path, :class => "vlink"



- unless @branches.empty?
  %table.table-striped
    %thead
      %tr
        %th=t '.name'
        %th=t '.commit'
        %th
    %tbody
      - @branches.each do |branch|
        %tr
          %td
            = link_to project_commits_path(@project, :ref => branch.name) do
              %strong= branch.name
              - if branch.name == @project.root_ref
                %span.label=t '.default'
          %td
            = link_to project_commits_path(@project, branch.commit.id) do
              = truncate branch.commit.id.to_s, :length => 10
            = time_ago_in_words(branch.commit.committed_date)
            = t 'global.ago'
          %td
            - if can? current_user, :admin_project, @project
              = link_to t('.unprotect'), [@project, branch], :confirm => t('global.destroy_confirm'), :method => :delete, :class => "danger btn small"



- if can? current_user, :admin_project, @project
  = form_for [@project, @protected_branch] do |f|
    -if @protected_branch.errors.any?
      .alert-message.block-message.error
        %ul
          - @protected_branch.errors.full_messages.each do |msg|
            %li= msg

    .clearfix
      = f.label :name
      .input= f.select(:name, @project.open_branches.map { |br| [br.name, br.name] } , { :include_blank => t('merge_requests.form.select_branch') }, { :style => "width:300px" })
    .actions
      = f.submit t('global.save'), :class => "primary btn"


:javascript
  $('select#protected_branch_name').chosen();
