%h3
  = t '.title', :id => @merge_request.id
  &nbsp;
  %span.pretty_label.branch= @merge_request.source_branch
  &rarr;
  %span.pretty_label.branch= @merge_request.target_branch

  %span.right
    - if can?(current_user, :modify_merge_request, @merge_request)
      - if @merge_request.open?
        = link_to t('merge_requests.how_to_merge.title'), "#", :class => "how_to_merge_link btn small padded", :title => t('merge_requests.how_to_merge.title')
        = link_to t('.resolve'), project_merge_request_path(@project, @merge_request, :merge_request => {:closed => true }, :status_only => true), :method => :put, :class => "btn small padded", :title => "Close merge request"
        = link_to edit_project_merge_request_path(@project, @merge_request), :class => "btn small padded" do 
          = t 'global.edit'

    %br
    - if @merge_request.upvotes > 0
      .upvotes#upvotes=pluralize(@issue.upvotes, t('.upvote'), t('.upvotes', :votes => @merge_request.upvotes))

= render "merge_requests/how_to_merge"
.back_link
  = link_to project_merge_requests_path(@project) do 
    &larr;
    = t '.back_to_list'

.main_box
  .top_box_content
    %h4
      - if @merge_request.closed
        .alert-message.error.status_info=t '.closed'
      - else 
        .alert-message.success.status_info=t '.open'
      = @merge_request.title

  .middle_box_content
    %div
      %cite.cgray
      = t '.created_at', :date => @merge_request.created_at.stamp(t('global.timestamp'))
      = image_tag gravatar_icon(@merge_request.author_email), :width => 16, :class => "lil_av"
      %strong.author= link_to_merge_request_author(@merge_request)

      %cite.cgray
      = t '.assigned_to'
      = image_tag gravatar_icon(@merge_request.assignee_email), :width => 16, :class => "lil_av"
      %strong.author= link_to_merge_request_assignee(@merge_request)


  - if @merge_request.closed
    .bottom_box_content
      - if @merge_request.merged?
        %span
          = t '.merged_by'
          = @merge_request.merge_event.author_name
          %small
            = time_ago_in_words(@merge_request.merge_event.created_at)
            = t 'global.ago'
      - elsif @merge_request.closed_event
        %span
          = t '.closed_by'
          = @merge_request.closed_event.author_name
          %small 
            = time_ago_in_words(@merge_request.closed_event.created_at)
            = t '.ago'

= render "merge_requests/commits"

- unless @commits.empty?
  .nav.nav-tabs
    %li.active
      = link_to "#notes", :class => "merge-notes-tab tab" do 
        = t '.notes'
    %li
      = link_to "#diffs", "data-url" => diffs_project_merge_request_path(@project, @merge_request), :class => "merge-diffs-tab tab" do
        = t '.diff'


.merge_request_notes#notes= render "notes/notes", :tid => @merge_request.id, :tt => "merge_request"

.merge-request-diffs
.status

:javascript
  $(function(){
    MergeRequest.init();
  })

= render "notes/per_line_form"

:javascript
  $(document).ready(function(){
    $(".line_note_link, .line_note_reply_link").live("click", function(e) { 
      var form = $(".per_line_form");
      $(this).parent().parent().after(form);
      form.find("#note_line_code").val($(this).attr("line_code"));
      form.show();  
      return false;
    });
  });
